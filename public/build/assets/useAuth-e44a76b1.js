import{S,r as f,s as h,z as u,U as n}from"./app-a93a371e.js";const c=new S({baseURL:"/api",tokenKey:"verifier_token",userKey:"verifier_user"});class _{async login(l,o){return await c.post("/verifier-platform/account/login",{account:l,password:o})}async logout(){return await c.post("/verifier-platform/account/logout")}async getCurrentVerifier(){return await c.get("/verifier-platform/account/me")}}const v=new _,s=f(null),i=f(!1),r=f(null),A=()=>{const t=localStorage.getItem("verifier_user"),l=localStorage.getItem("verifier_token");if(t&&l)try{s.value=JSON.parse(t)}catch(o){console.error("解析核銷人員資料失敗:",o),localStorage.removeItem("verifier_user"),localStorage.removeItem("verifier_token")}else t&&!l&&(localStorage.removeItem("verifier_user"),s.value=null)};A();function k(){const t=h(),l=async(e,I)=>{i.value=!0,r.value=null;try{const a=await v.login(e,I);return a.status?(s.value=a.data.verifier,localStorage.setItem("verifier_user",JSON.stringify(a.data.verifier)),localStorage.setItem("verifier_token",a.data.token),t.push("/verifier/dashboard"),{success:!0,data:a.data}):(r.value=a.message,{success:!1,message:a.message})}catch(a){return r.value=a.message||"登入失敗",{success:!1,message:r.value}}finally{i.value=!1}},o=async()=>{i.value=!0,r.value=null;try{try{await v.logout()}catch(e){console.warn("後端登出失敗，但繼續清除前端資料:",e.message)}return s.value=null,localStorage.removeItem("verifier_user"),localStorage.removeItem("verifier_token"),t.push("/verifier/login"),{success:!0,message:"登出成功"}}catch(e){return r.value=e.message||"登出失敗",{success:!1,message:r.value}}finally{i.value=!1}},g=async()=>{i.value=!0,r.value=null;try{const e=await v.getCurrentVerifier();return e.status?(s.value=e.data.verifier,{success:!0,data:e.data}):(r.value=e.message,{success:!1,message:e.message})}catch(e){return r.value=e.message||"取得核銷人員資訊失敗",{success:!1,message:r.value}}finally{i.value=!1}},m=()=>{r.value=null},y=u(()=>!!s.value),d=u(()=>{var e;return((e=s.value)==null?void 0:e.name)||""}),p=u(()=>{var e;return((e=s.value)==null?void 0:e.account)||""});return{verifier:n(s),isLoading:n(i),error:n(r),isAuthenticated:y,verifierName:d,verifierAccount:p,login:l,logout:o,getCurrentVerifier:g,clearError:m}}export{k as u,c as v};
