import{a as w,_ as J,b as K,r as g,y as M,o as Q,c as d,d as e,f as m,p as c,v as f,s as I,F as W,g as X,t as l,j as h,q as Z,i as O,h as i}from"./app-9d7b164d.js";class tt{async list(r={}){return w.get("/announcements",r)}async create(r){return w.post("/announcements",r)}async update(r,b){return w.put(`/announcements/${r}`,b)}async remove(r){return w.delete(`/announcements/${r}`)}async get(r){return w.get(`/announcements/${r}`)}}const C=new tt;const et={class:"container mx-auto px-4 py-8"},st={class:"max-w-7xl mx-auto"},at={class:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-2xl p-8 border border-white/20"},ot={class:"mb-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3"},nt={class:"bg-white rounded-xl shadow-lg overflow-hidden"},rt={class:"overflow-x-auto"},lt={class:"min-w-full divide-y divide-gray-200"},dt={class:"bg-white divide-y divide-gray-200"},it={key:0},ut={key:1},ct={class:"td-base"},pt={class:"text-sm font-medium text-gray-900"},gt={key:0,class:"text-sm text-gray-500 truncate max-w-xl"},mt={class:"td-base"},ft={class:"td-base"},bt={class:"td-base text-gray-500"},yt={class:"td-base font-medium"},xt={class:"action-buttons"},vt=["onClick"],_t=["onClick"],wt={key:0,class:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6"},ht={class:"text-sm text-gray-700"},kt={class:"font-medium"},$t={class:"font-medium"},Ct={class:"font-medium"},Vt={class:"flex items-center gap-2"},Dt=["disabled"],St=["disabled"],jt={key:0,class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"},Mt={class:"relative top-20 mx-auto p-5 border w-11/12 md:w-2/3 lg:w-1/2 shadow-lg rounded-md bg-white"},Ut={class:"mt-3"},At={class:"flex items-center justify-between mb-4"},Et={class:"text-lg font-medium text-gray-900"},Tt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},It={class:"md:col-span-2"},Ot={key:0,class:"text-red-500 text-xs mt-1"},Bt={class:"md:col-span-2"},Ft={class:"md:col-span-2"},Ht={class:"flex justify-end gap-3 pt-2"},Nt=["disabled"],Pt={key:0,class:"fas fa-spinner fa-spin mr-2"},qt={__name:"Announcement",setup(B){const{success:r,error:b}=K(),V=g([]),D=g(!1),n=g(null),u=M({search:"",is_active:"",starts_from:"",ends_to:"",sort_by:"starts_at",sort_order:"desc",per_page:15});let U=null;const F=()=>{clearTimeout(U),U=setTimeout(()=>$(),500)},x=g(!1),y=g(!1),k=g(!1),S=g(null),o=M({title:"",content:"",starts_at:"",ends_at:"",is_active:!0}),p=M({}),v=async(a=1)=>{var t;D.value=!0;try{const s=await C.list({...u,page:a});if(s.status)V.value=Array.isArray((t=s.data)==null?void 0:t.data)?s.data.data:[],n.value={current_page:s.data.current_page,last_page:s.data.last_page,per_page:s.data.per_page,total:s.data.total,from:s.data.from,to:s.data.to};else throw new Error(s.message||"載入公告失敗")}catch(s){console.error("載入公告錯誤:",s),b(s.message||"載入公告失敗")}finally{D.value=!1}},$=()=>{var a;return v(((a=n.value)==null?void 0:a.current_page)||1)},A=a=>{a>=1&&a<=n.value.last_page&&v(a)},H=()=>{y.value=!1,S.value=null,Object.assign(o,{title:"",content:"",starts_at:"",ends_at:"",is_active:!0}),Object.keys(p).forEach(a=>delete p[a]),x.value=!0},N=a=>{y.value=!0,S.value=a.id,Object.assign(o,{title:a.title||"",content:a.content||"",starts_at:a.starts_at?T(a.starts_at):"",ends_at:a.ends_at?T(a.ends_at):"",is_active:!!a.is_active}),Object.keys(p).forEach(t=>delete p[t]),x.value=!0},E=()=>{x.value=!1},P=async()=>{k.value=!0;try{const a={title:o.title,content:o.content,starts_at:o.starts_at?new Date(o.starts_at).toISOString():null,ends_at:o.ends_at?new Date(o.ends_at).toISOString():null,is_active:!!o.is_active};let t;if(y.value?t=await C.update(S.value,a):t=await C.create(a),t.status)r(y.value?"公告更新成功":"公告建立成功"),x.value=!1,await v();else if(t.errors)Object.assign(p,t.errors),b(t.message||"操作失敗");else throw new Error(t.message||"操作失敗")}catch(a){console.error("提交公告錯誤:",a),b(a.message||"操作失敗")}finally{k.value=!1}},q=async a=>{if(confirm(`確認刪除公告「${a.title}」？`))try{const t=await C.remove(a.id);if(t.status)r("公告刪除成功"),await v();else throw new Error(t.message||"刪除失敗")}catch(t){console.error("刪除公告錯誤:",t),b(t.message||"刪除失敗")}},j=a=>{if(!a)return"-";const t=new Date(a),s=R=>String(R).padStart(2,"0"),_=t.getFullYear(),z=s(t.getMonth()+1),G=s(t.getDate()),L=s(t.getHours()),Y=s(t.getMinutes());return`${_}/${z}/${G} ${L}:${Y}`},T=a=>{const t=new Date(a),s=_=>String(_).padStart(2,"0");return`${t.getFullYear()}-${s(t.getMonth()+1)}-${s(t.getDate())}T${s(t.getHours())}:${s(t.getMinutes())}`};return Q(()=>v()),(a,t)=>(i(),d("div",et,[e("div",st,[e("div",at,[e("div",{class:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8"},[t[12]||(t[12]=e("div",null,[e("h2",{class:"text-2xl font-bold text-gray-800 mb-2"},"公告欄"),e("p",{class:"text-gray-600"},"管理系統公告與重要訊息")],-1)),e("div",{class:"flex gap-3 mt-4 sm:mt-0"},[e("button",{onClick:H,class:"bg-gradient-to-r from-green-500 to-green-600 text-white py-3 px-6 rounded-xl font-semibold hover:from-green-600 hover:to-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5"},[...t[11]||(t[11]=[e("i",{class:"fas fa-plus mr-2"},null,-1),m("新增公告 ",-1)])])])]),e("div",ot,[c(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>u.search=s),type:"text",placeholder:"搜尋標題/內文",class:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-amber-500 focus:border-transparent",onInput:F},null,544),[[f,u.search]]),c(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>u.is_active=s),onChange:$,class:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-amber-500 focus:border-transparent"},[...t[13]||(t[13]=[e("option",{value:""},"全部狀態",-1),e("option",{value:"1"},"啟用",-1),e("option",{value:"0"},"停用",-1)])],544),[[I,u.is_active]]),c(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>u.starts_from=s),type:"date",class:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-amber-500 focus:border-transparent",onChange:$},null,544),[[f,u.starts_from]]),c(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>u.ends_to=s),type:"date",class:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-amber-500 focus:border-transparent",onChange:$},null,544),[[f,u.ends_to]])]),e("div",nt,[e("div",rt,[e("table",lt,[t[18]||(t[18]=e("thead",{class:"bg-gradient-to-r from-amber-50 to-orange-50"},[e("tr",null,[e("th",{class:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"標題"),e("th",{class:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"期間"),e("th",{class:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"狀態"),e("th",{class:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"更新時間"),e("th",{class:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"操作")])],-1)),e("tbody",dt,[D.value?(i(),d("tr",it,[...t[14]||(t[14]=[e("td",{colspan:"5",class:"px-6 py-8 text-center text-gray-500"},[e("i",{class:"fas fa-spinner fa-spin mr-2"}),m("載入中...")],-1)])])):V.value.length===0?(i(),d("tr",ut,[...t[15]||(t[15]=[e("td",{colspan:"5",class:"px-6 py-8 text-center text-gray-500"},"沒有公告資料",-1)])])):(i(!0),d(W,{key:2},X(V.value,s=>(i(),d("tr",{key:s.id,class:"hover:bg-gray-50"},[e("td",ct,[e("div",pt,l(s.title),1),s.content?(i(),d("div",gt,l(s.content),1)):h("",!0)]),e("td",mt,l(j(s.starts_at))+" ~ "+l(j(s.ends_at)),1),e("td",ft,[e("span",{class:O([s.is_active?"bg-green-100 text-green-800":"bg-gray-200 text-gray-700","inline-flex px-2 py-1 text-xs font-semibold rounded-full"])},l(s.is_active?"啟用":"停用"),3)]),e("td",bt,l(j(s.updated_at)),1),e("td",yt,[e("div",xt,[e("button",{onClick:_=>N(s),class:"action-btn action-btn--edit",title:"編輯"},[...t[16]||(t[16]=[e("i",{class:"fas fa-edit action-icon"},null,-1)])],8,vt),e("button",{onClick:_=>q(s),class:"action-btn action-btn--delete",title:"刪除"},[...t[17]||(t[17]=[e("i",{class:"fas fa-trash action-icon"},null,-1)])],8,_t)])])]))),128))])])]),n.value&&n.value.last_page>1?(i(),d("div",wt,[e("div",ht,[t[19]||(t[19]=m("顯示第 ",-1)),e("span",kt,l(n.value.from||0),1),t[20]||(t[20]=m(" 到 ",-1)),e("span",$t,l(n.value.to||0),1),t[21]||(t[21]=m(" 筆，共 ",-1)),e("span",Ct,l(n.value.total),1),t[22]||(t[22]=m(" 筆",-1))]),e("div",Vt,[e("button",{disabled:n.value.current_page<=1,onClick:t[4]||(t[4]=s=>A(n.value.current_page-1)),class:"px-3 py-1 border rounded disabled:opacity-50"},"上一頁",8,Dt),e("button",{disabled:n.value.current_page>=n.value.last_page,onClick:t[5]||(t[5]=s=>A(n.value.current_page+1)),class:"px-3 py-1 border rounded disabled:opacity-50"},"下一頁",8,St)])])):h("",!0)])])]),x.value?(i(),d("div",jt,[e("div",Mt,[e("div",Ut,[e("div",At,[e("h3",Et,l(y.value?"編輯公告":"新增公告"),1),e("button",{onClick:E,class:"text-gray-400 hover:text-gray-600"},[...t[23]||(t[23]=[e("i",{class:"fas fa-times text-xl"},null,-1)])])]),e("form",{onSubmit:Z(P,["prevent"]),class:"space-y-4"},[e("div",Tt,[e("div",It,[t[24]||(t[24]=e("label",{class:"label-base"},"標題 *",-1)),c(e("input",{"onUpdate:modelValue":t[6]||(t[6]=s=>o.title=s),required:"",class:O(["w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-transparent",{"border-red-500":p.title}])},null,2),[[f,o.title]]),p.title?(i(),d("p",Ot,l(p.title),1)):h("",!0)]),e("div",null,[t[25]||(t[25]=e("label",{class:"label-base"},"開始時間",-1)),c(e("input",{"onUpdate:modelValue":t[7]||(t[7]=s=>o.starts_at=s),type:"datetime-local",lang:"en-GB",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-transparent"},null,512),[[f,o.starts_at]])]),e("div",null,[t[26]||(t[26]=e("label",{class:"label-base"},"結束時間",-1)),c(e("input",{"onUpdate:modelValue":t[8]||(t[8]=s=>o.ends_at=s),type:"datetime-local",lang:"en-GB",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-transparent"},null,512),[[f,o.ends_at]])]),e("div",Bt,[t[28]||(t[28]=e("label",{class:"label-base"},"啟用狀態",-1)),c(e("select",{"onUpdate:modelValue":t[9]||(t[9]=s=>o.is_active=s),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-transparent"},[...t[27]||(t[27]=[e("option",{value:!0},"啟用",-1),e("option",{value:!1},"停用",-1)])],512),[[I,o.is_active]])]),e("div",Ft,[t[29]||(t[29]=e("label",{class:"label-base"},"公告內文",-1)),c(e("textarea",{"onUpdate:modelValue":t[10]||(t[10]=s=>o.content=s),rows:"5",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-transparent"},null,512),[[f,o.content]])])]),e("div",Ht,[e("button",{type:"button",onClick:E,class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50"},"取消"),e("button",{type:"submit",disabled:k.value,class:"px-4 py-2 text-sm font-medium text-white bg-amber-600 rounded-md hover:bg-amber-700 disabled:opacity-50"},[k.value?(i(),d("i",Pt)):h("",!0),m(l(y.value?"更新":"建立"),1)],8,Nt)])],32)])])])):h("",!0)]))}},Gt=J(qt,[["__scopeId","data-v-9b63b159"]]);export{Gt as default};
