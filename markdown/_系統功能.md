# 土方石清運管理系統 - 後台功能規劃

## 🏗️ 系統架構

本專案採用以下分層設計模式：
Controller → Service → Repository → Model

- Controller：取得與驗證請求參數、呼叫 Service、包裝統一回應格式、處理例外、記錄操作日誌
- Service：編排商業邏輯流程、整備參數、掌管交易邊界（DB Transaction）
- Repository：封裝資料庫查詢與交易、維持資料存取的一致抽象
- 禁止事項：嚴禁在 Controller／Service 直接進行資料庫查詢與交易

---

## 📋 管理後台功能清單

### 1. 後台帳號管理（無限制帳號）
- **功能描述**：管理後台系統的使用者帳號
- **子功能**：
  - 使用者 CRUD 操作
  - 角色權限管理
  - 帳號狀態管理
- **狀態**：✅ 已完成（使用者管理頁面）

### 2. 登入/登出/忘記密碼
- **功能描述**：系統認證相關功能
- **子功能**：
  - 使用者登入
  - 使用者登出
  - 忘記密碼重設
- **狀態**：✅ 已完成（登入功能）

### 3. 客戶基本資料
- **功能描述**：管理客戶的基本資訊
- **子功能**：
  - 客戶資料 CRUD
  - 客戶分類管理
  - 聯絡資訊管理
- **狀態**：🔄 待開發

### 4. 案件維護管理
- **功能描述**：管理運輸案件的基本資訊
- **子功能**：
  - 案件建立與編輯
  - 案件狀態追蹤
  - 案件分類管理
- **狀態**：🔄 待開發

### 5. 土單資料維護管理
- **功能描述**：核心業務功能 - 土單管理
- **子功能**：
  - **針對案件開立土單併產生 QR Code**
    - 為特定案件建立土單
    - 自動產生 QR Code 用於追蹤
  - **列印土單（點陣式印表機）**
    - 支援點陣式印表機列印
    - 格式化土單列印
- **狀態**：🔄 待開發

### 6. 土單回收作業
- **功能描述**：處理土單回收相關作業
- **子功能**：
  - **案件土單回收數量回填**
    - 記錄回收的土單數量
    - 更新案件狀態
- **狀態**：🔄 待開發

### 7. 土單使用統計表
- **功能描述**：提供土單使用情況的統計報表
- **子功能**：
  - **統計各案件開立土單數量/已核銷數量/廢棄數量/回收數量**
    - 開立土單數量統計
    - 已核銷數量統計
    - 廢棄數量統計
    - 回收數量統計
- **狀態**：🔄 待開發

### 8. 公告欄
- **功能描述**：系統內部公告與訊息發布
- **子功能**：
  - 公告發布與管理
  - 重要訊息通知
  - 系統維護公告
- **狀態**：🔄 待開發

---

## 📁 資料夾結構

```
app/
├── Http/
│   └── Controllers/
│       ├── AccountController.php      # 認證相關
│       ├── UserController.php         # 使用者管理
│       ├── CustomerController.php     # 客戶管理（待開發）
│       ├── CaseController.php         # 案件管理（待開發）
│       ├── EarthSlipController.php    # 土單管理（待開發）
│       ├── ReportController.php       # 報表管理（待開發）
│       └── AnnouncementController.php # 公告管理（待開發）
├── Services/
│   ├── AccountService.php             # 認證相關
│   ├── UserService.php                # 使用者管理
│   ├── CustomerService.php            # 待開發
│   ├── CaseService.php                # 待開發
│   ├── EarthSlipService.php           # 待開發
│   ├── ReportService.php              # 待開發
│   └── AnnouncementService.php        # 待開發
├── Repositories/
│   ├── UserRepository.php
│   ├── CustomerRepository.php         # 待開發
│   ├── CaseRepository.php             # 待開發
│   ├── EarthSlipRepository.php        # 待開發
│   ├── ReportRepository.php           # 待開發
│   └── AnnouncementRepository.php     # 待開發
├── Models/
│   ├── User.php
│   ├── Customer.php                   # 待開發
│   ├── Case.php                       # 待開發
│   ├── EarthSlip.php                  # 待開發
│   └── Announcement.php               # 待開發
└── Formatters/
    └── ApiOutput.php
```

---

## 🛣️ 路由命名規則

### 命名格式
```
{第一層}.{第二層}.{第三層}.{第四層}
```

### 各層說明
| 層級 | 說明 | 範例 |
|------|------|------|
| **第一層** | 類型識別 | `web` (網頁)、`api` (API) |
| **第二層** | 網址路徑 | `customer`、`case`、`earth-slip` |
| **第三層** | 權限代號 | `api-index`、`api-list`、`api-export` |
| **第四層** | 方法名稱 | `index`、`show`、`store`、`update`、`delete` |

---

## 🐳 Laradocker 容器執行方式

### 容器資訊
- **容器名稱**: `laradock-workspace-1`
- **專案路徑**: `/var/www/case/01_mingo/wu-cheer`
- **PHP 版本**: 8.4
- **Laravel 版本**: 12.x

### 常用指令

#### 1. 進入容器執行指令
```bash
docker exec laradock-workspace-1 bash -c "cd /var/www/case/01_mingo/wu-cheer && [指令]"
```

#### 2. 常用 Laravel 指令
```bash
# 查看路由
docker exec laradock-workspace-1 bash -c "cd /var/www/case/01_mingo/wu-cheer && php artisan route:list"

# 資料庫遷移
docker exec laradock-workspace-1 bash -c "cd /var/www/case/01_mingo/wu-cheer && php artisan migrate"

# 建立測試資料
docker exec laradock-workspace-1 bash -c "cd /var/www/case/01_mingo/wu-cheer && php artisan db:seed --class=TestUserSeeder"

# 啟動開發伺服器
docker exec laradock-workspace-1 bash -c "cd /var/www/case/01_mingo/wu-cheer && php artisan serve --host=0.0.0.0 --port=8000"
```

#### 3. API 測試指令
```bash
# 登入測試
docker exec laradock-workspace-1 bash -c "cd /var/www/case/01_mingo/wu-cheer && curl -X POST http://localhost:8000/api/account/login -H 'Content-Type: application/json' -d '{\"email\": \"test@example.com\", \"password\": \"password123\"}'"

# 登出測試
docker exec laradock-workspace-1 bash -c "cd /var/www/case/01_mingo/wu-cheer && curl -X POST http://localhost:8000/api/account/logout -H 'Content-Type: application/json'"

# 取得帳戶資訊測試
docker exec laradock-workspace-1 bash -c "cd /var/www/case/01_mingo/wu-cheer && curl -X GET http://localhost:8000/api/account/me -H 'Content-Type: application/json'"
```

### 容器狀態檢查
```bash
# 查看運行中的容器
docker ps

# 查看容器端口映射
docker port laradock-nginx-1
docker port laradock-workspace-1
```

### 注意事項
- 專案檔案位於宿主機的 `/Users/mingotsai/Work/projects/case/01_mingo/wu-cheer`
- 容器內專案路徑為 `/var/www/case/01_mingo/wu-cheer`
- 使用 `laradock-workspace-1` 容器執行所有 Laravel 指令
- 開發伺服器預設運行在 `http://localhost:8000`

---

## 🚀 開發優先順序

### 第一階段（已完成）
1. ✅ 系統架構建立
2. ✅ 使用者認證功能
3. ✅ 使用者管理 CRUD
4. ✅ 前端 Layout 設計

### 第二階段（建議優先開發）
1. 🔄 客戶基本資料管理
2. 🔄 案件維護管理
3. 🔄 公告欄功能

### 第三階段（核心業務功能）
1. 🔄 土單資料維護管理
2. 🔄 土單回收作業
3. 🔄 土單使用統計表

---

## 📊 功能狀態圖例

- ✅ 已完成
- 🔄 待開發
- ⚠️ 進行中
- ❌ 暫停開發
