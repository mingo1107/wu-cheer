# Laravel å°ˆæ¡ˆåˆ†å±¤æ¶æ§‹èªªæ˜

æœ¬å°ˆæ¡ˆæ¡ç”¨ä»¥ä¸‹åˆ†å±¤è¨­è¨ˆæ¨¡å¼ï¼š
Controller â†’ Service â†’ Repository â†’ Model

- Controllerï¼šå–å¾—èˆ‡é©—è­‰è«‹æ±‚åƒæ•¸ã€å‘¼å« Serviceã€åŒ…è£çµ±ä¸€å›æ‡‰æ ¼å¼ã€è™•ç†ä¾‹å¤–ã€è¨˜éŒ„æ“ä½œæ—¥èªŒ
- Serviceï¼šç·¨æ’å•†æ¥­é‚è¼¯æµç¨‹ã€æ•´å‚™åƒæ•¸ã€æŒç®¡äº¤æ˜“é‚Šç•Œï¼ˆDB Transactionï¼‰
- Repositoryï¼šå°è£è³‡æ–™åº«æŸ¥è©¢èˆ‡äº¤æ˜“ã€ç¶­æŒè³‡æ–™å­˜å–çš„ä¸€è‡´æŠ½è±¡
- ç¦æ­¢äº‹é …ï¼šåš´ç¦åœ¨ Controllerï¼Service ç›´æ¥é€²è¡Œè³‡æ–™åº«æŸ¥è©¢èˆ‡äº¤æ˜“

è«‹å‹™å¿…éµå¾ªä»¥ä¸Šé–‹ç™¼æ–¹å¼ï¼Œä»¥æé«˜å¯ç¶­è­·æ€§èˆ‡å¯æ“´å……æ€§ã€‚

---

## ğŸ“ è³‡æ–™å¤¾çµæ§‹

```
app/
â”œâ”€â”€ Http/
â”‚   â””â”€â”€ Controllers/
â”‚       â””â”€â”€ AccountController.php
â”œâ”€â”€ Services/
â”‚   â””â”€â”€ UserService.php
â”œâ”€â”€ Repositories/
â”‚   â””â”€â”€ UserRepository.php
â”œâ”€â”€ Models/
â”‚   â””â”€â”€ User.php
```

---

## å‰ç«¯æª”æ¡ˆçµæ§‹èˆ‡é é¢è¦ç¯„

```
resources/js/
â”œâ”€â”€ api/                      # API æ¨¡çµ„ï¼ˆaxios å°è£ï¼‰
â”‚   â”œâ”€â”€ base.js
â”‚   â”œâ”€â”€ user.js
â”‚   â””â”€â”€ customer.js
â”œâ”€â”€ components/               # å¯å…±ç”¨å…ƒä»¶èˆ‡å¸ƒå±€
â”‚   â”œâ”€â”€ Layout.vue            # ç‰ˆé¢é…ç½®ï¼ˆä¿ç•™ï¼‰
â”‚   â”œâ”€â”€ Toast.vue             # é€šç”¨é€šçŸ¥ï¼ˆä¿ç•™ï¼‰
â”‚   â””â”€â”€ App.vue               # Root
â”œâ”€â”€ pages/                    # è·¯ç”±å°æ‡‰çš„é é¢
â”‚   â”œâ”€â”€ Login.vue
â”‚   â”œâ”€â”€ Dashboard.vue
â”‚   â”œâ”€â”€ Profile.vue
â”‚   â”œâ”€â”€ User.vue
â”‚   â”œâ”€â”€ Customer.vue
â”‚   â”œâ”€â”€ Announcement.vue
â”‚   â”œâ”€â”€ Case.vue
â”‚   â”œâ”€â”€ EarthData.vue
â”‚   â”œâ”€â”€ EarthRecycle.vue
â”‚   â”œâ”€â”€ EarthStatistics.vue
â”‚   â””â”€â”€ NotFound.vue
â””â”€â”€ router/
    â””â”€â”€ index.js
```

### è¦ç¯„èªªæ˜
- **é é¢æª”æ¡ˆ**ä¸€å¾‹æ”¾åœ¨ `resources/js/pages/`ã€‚
- **å…±ç”¨å…ƒä»¶/å¸ƒå±€**æ”¾åœ¨ `resources/js/components/`ï¼ˆä¾‹å¦‚ï¼š`Layout.vue`ã€`Toast.vue`ï¼‰ã€‚
- **Router** éœ€å¾ `pages/` è¼‰å…¥é é¢ï¼š

```js
// resources/js/router/index.js
import Login from '../pages/Login.vue'
import Layout from '../components/Layout.vue'

{
  path: 'dashboard',
  component: () => import('../pages/Dashboard.vue')
}
```

### æ¸…ç†èªªæ˜
- å·²å°‡åŸæœ¬åœ¨ `components/` å…§çš„é é¢ç§»è‡³ `pages/`ã€‚
- ç¢ºèªè·¯ç”±å·²æŒ‡å‘ `pages/` å¾Œï¼Œå³å¯åˆªé™¤ `components/` ä¸­å°æ‡‰çš„èˆŠé é¢æª”æ¡ˆã€‚

---

## ğŸ›£ï¸ è·¯ç”±å‘½åè¦å‰‡

### å‘½åæ ¼å¼
```
{ç¬¬ä¸€å±¤}.{ç¬¬äºŒå±¤}.{ç¬¬ä¸‰å±¤}.{ç¬¬å››å±¤}
```

### å„å±¤èªªæ˜
| å±¤ç´š | èªªæ˜ | ç¯„ä¾‹ |
|------|------|------|
| **ç¬¬ä¸€å±¤** | é¡å‹è­˜åˆ¥ | `web` (ç¶²é )ã€`api` (API) |
| **ç¬¬äºŒå±¤** | ç¶²å€è·¯å¾‘ | `report-customer` |
| **ç¬¬ä¸‰å±¤** | æ¬Šé™ä»£è™Ÿ | `api-index`ã€`api-list`ã€`api-export` |
| **ç¬¬å››å±¤** | æ–¹æ³•åç¨± | `index`ã€`show`ã€`store`ã€`update`ã€`delete` |

---

## ğŸ³ Laradocker å®¹å™¨åŸ·è¡Œæ–¹å¼

### å®¹å™¨è³‡è¨Š
- **å®¹å™¨åç¨±**: `laradock-workspace-1`
- **å°ˆæ¡ˆè·¯å¾‘**: `/var/www/case/01_mingo/wu-cheer`
- **PHP ç‰ˆæœ¬**: 8.4
- **Laravel ç‰ˆæœ¬**: 12.x

### å¸¸ç”¨æŒ‡ä»¤

#### 1. é€²å…¥å®¹å™¨åŸ·è¡ŒæŒ‡ä»¤
```bash
docker exec laradock-workspace-1 bash -c "cd /var/www/case/01_mingo/wu-cheer && [æŒ‡ä»¤]"
```

#### 2. å¸¸ç”¨ Laravel æŒ‡ä»¤
```bash
# æŸ¥çœ‹è·¯ç”±
docker exec laradock-workspace-1 bash -c "cd /var/www/case/01_mingo/wu-cheer && php artisan route:list"

# è³‡æ–™åº«é·ç§»
docker exec laradock-workspace-1 bash -c "cd /var/www/case/01_mingo/wu-cheer && php artisan migrate"

# å»ºç«‹æ¸¬è©¦è³‡æ–™
docker exec laradock-workspace-1 bash -c "cd /var/www/case/01_mingo/wu-cheer && php artisan db:seed --class=TestUserSeeder"

# å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨
docker exec laradock-workspace-1 bash -c "cd /var/www/case/01_mingo/wu-cheer && php artisan serve --host=0.0.0.0 --port=8000"
```

#### 3. API æ¸¬è©¦æŒ‡ä»¤
```bash
# ç™»å…¥æ¸¬è©¦
curl -X POST http://wu-cheer.local.com/api/account/login -H 'Content-Type: application/json' -d '{"email": "test@example.com", "password": "password123"}'

# ç™»å‡ºæ¸¬è©¦
curl -X POST http://wu-cheer.local.com/api/account/logout -H 'Content-Type: application/json' -H 'Authorization: Bearer YOUR_JWT_TOKEN'

# å–å¾—å¸³æˆ¶è³‡è¨Šæ¸¬è©¦
curl -X GET http://wu-cheer.local.com/api/account/me -H 'Content-Type: application/json' -H 'Authorization: Bearer YOUR_JWT_TOKEN'

# ä¿®æ”¹å¯†ç¢¼æ¸¬è©¦
curl -X POST http://wu-cheer.local.com/api/account/change-password -H 'Content-Type: application/json' -H 'Authorization: Bearer YOUR_JWT_TOKEN' -d '{"current_password": "password123", "new_password": "newpassword456", "new_password_confirmation": "newpassword456"}'
```

### å®¹å™¨ç‹€æ…‹æª¢æŸ¥
```bash
# æŸ¥çœ‹é‹è¡Œä¸­çš„å®¹å™¨
docker ps

# æŸ¥çœ‹å®¹å™¨ç«¯å£æ˜ å°„
docker port laradock-nginx-1
docker port laradock-workspace-1
```

### æ³¨æ„äº‹é …
- å°ˆæ¡ˆæª”æ¡ˆä½æ–¼å®¿ä¸»æ©Ÿçš„ `/Users/mingotsai/Work/projects/case/01_mingo/wu-cheer`
- å®¹å™¨å…§å°ˆæ¡ˆè·¯å¾‘ç‚º `/var/www/case/01_mingo/wu-cheer`
- ä½¿ç”¨ `laradock-workspace-1` å®¹å™¨åŸ·è¡Œæ‰€æœ‰ Laravel æŒ‡ä»¤
- é–‹ç™¼ä¼ºæœå™¨é è¨­é‹è¡Œåœ¨ `http://localhost:8000`

---

## API æ¨™æº–å›å‚³æ ¼å¼

æ‰€æœ‰ API çµ±ä¸€æ¡ç”¨ä»¥ä¸‹å›å‚³æ ¼å¼ï¼Œå‰ç«¯è«‹ä»¥ `status` åˆ¤æ–·æ˜¯å¦æˆåŠŸï¼Œè³‡æ–™åœ¨ `data` æ¬„ä½ä¸­ã€‚

```json
{
  "status": true,
  "message": "æ“ä½œæˆåŠŸ",
  "code": 200,
  "data": {
    "current_page": 1,
    "data": [
      { /* è³‡æ–™åˆ— */ }
    ],
    "first_page_url": "http://wu-cheer.local.com/api/{resource}?page=1",
    "from": 1,
    "last_page": 1,
    "last_page_url": "http://wu-cheer.local.com/api/{resource}?page=1",
    "links": [
      { "url": null, "label": "&laquo; Previous", "page": null, "active": false },
      { "url": "http://wu-cheer.local.com/api/{resource}?page=1", "label": "1", "page": 1, "active": true },
      { "url": null, "label": "Next &raquo;", "page": null, "active": false }
    ],
    "next_page_url": null,
    "path": "http://wu-cheer.local.com/api/{resource}",
    "per_page": 15,
    "prev_page_url": null,
    "to": 15,
    "total": 15
  }
}
```

èªªæ˜ï¼š
- **status**: å¸ƒæ—ï¼ŒæˆåŠŸç‚º `true`ï¼Œå¤±æ•—ç‚º `false`
- **message**: å­—ä¸²ï¼Œæ“ä½œçµæœè¨Šæ¯
- **code**: æ•¸å­—ï¼ŒHTTP/æ‡‰ç”¨å±¤ä»£ç¢¼ï¼ˆé è¨­ 200 æˆåŠŸï¼‰
- **data**: ç‰©ä»¶ï¼Œåˆ—è¡¨å›å‚³ç‚º Laravel åˆ†é çµæ§‹ï¼ˆå« `data` é™£åˆ—èˆ‡åˆ†é æ¬„ä½ï¼‰

---

## æ¨™æº–å‘¼å« API æ–¹å¼ï¼ˆå‰ç«¯ï¼‰

çµ±ä¸€ä½¿ç”¨ `axios` å°è£æ–¼ `resources/js/api/base.js` çš„ `api` å¯¦ä¾‹é€²è¡Œå‘¼å«ã€‚

- **åŸºåº• URL**: `/api`
- **é è¨­æ¨™é ­**: `Content-Type: application/json`ã€`Accept: application/json`
- **èªè­‰**: æ–¼è«‹æ±‚æ””æˆªå™¨è‡ªå‹•å¸¶å…¥ `Authorization: Bearer <token>`ï¼ˆä¾†æº `localStorage.token`ï¼‰
- **é€¾æ™‚**: 10 ç§’
- **éŒ¯èª¤è™•ç†**: å›æ‡‰æ””æˆªå™¨é›†ä¸­è™•ç†ï¼ˆå« 401 æ¸… Token ä¸¦å¯é‡å°ç™»å…¥ï¼‰

### å°è£æª”æ¡ˆ
- ä½ç½®ï¼š`resources/js/api/base.js`
- æ–¹æ³•ï¼š`api.get(url, params)`ã€`api.post(url, body)`ã€`api.put(url, body)`ã€`api.delete(url, body)`
- 401 é‡å°è¨­å®šï¼šå¯æ–¼æ‡‰ç”¨å•Ÿå‹•æ™‚è¨­å®š

```js
// ç¯„ä¾‹ï¼šæ–¼ main.js æˆ– router è¨­å®šä¸­
import api from '@/api/base.js'
import router from '@/router'

api.setRedirectCallback((path) => router.push(path))
```

### å‘¼å«å›å‚³çµæ§‹
- æ‰€æœ‰ API å›å‚³ç‰©ä»¶çµæ§‹è«‹ä¾ã€ŒAPI æ¨™æº–å›å‚³æ ¼å¼ã€ï¼Œä»¥ `status` åˆ¤æ–·æˆåŠŸ/å¤±æ•—ã€‚

### ä½¿ç”¨ç¯„ä¾‹

```js
// å–å¾—ä½¿ç”¨è€…åˆ—è¡¨ï¼ˆå¸¶æŸ¥è©¢åƒæ•¸ï¼‰
const resp = await api.get('/users', { search: keyword })
if (resp.status) {
  const list = resp.data.data // Laravel åˆ†é çš„è³‡æ–™é™£åˆ—
}

// å»ºç«‹ä½¿ç”¨è€…
const resp = await api.post('/users', {
  name, email, password, password_confirmation
})
if (resp.status) {
  // æˆåŠŸè™•ç†
}

// æ›´æ–°ä½¿ç”¨è€…
const resp = await api.put(`/users/${id}`, payload)
if (resp.status) { /* ... */ }

// åˆªé™¤ä½¿ç”¨è€…
const resp = await api.delete(`/users/${id}`)
if (resp.status) { /* ... */ }
```

### çµ„ä»¶ä½¿ç”¨å»ºè­°
- å„ªå…ˆé€éå°æ‡‰çš„ API æ¨¡çµ„ï¼ˆä¾‹å¦‚ï¼š`resources/js/api/user.js`ï¼‰å‘¼å«ï¼Œé¿å…åœ¨çµ„ä»¶ä¸­é‡è¤‡å¯« `fetch`/`axios` ç´°ç¯€ã€‚
- å‰ç«¯å…ƒä»¶åˆ¤æ–·æˆåŠŸä¸€å¾‹ä½¿ç”¨ï¼š`if (response.status) { ... }`.
